\chapter{Discussion}

\section{Modeling the forces}
A vehicle and a tire are complex matters and therefor hard to describe with theoretical models. There are many factors that have been simplified and approximated in order to make appropriate calculations. Along the way, these simplifications and approximations do not always agree with reality, which makes the results unreliable. 

\subsection{The complexity of a tire}
One of the greatest challenges in this work was to model a tire correctly. Even a normal road tire, nothing fancy at all, is an extremely complex structure to model mathematically. One of the most accurate tire model of today is considered to be Pacejka's Magic Formula \cite{pacejka}. The reason for the accuracy is simply that it's a semi empirical model that's actually not connected to a tires physical properties at all. It's (extremely) simply put just a customizable polynomial that can be adjusted to fit a tires force per slip ratio curve very well. This is really good in a laboratory environment for example where one specific tire needs to be modeled for a series of tests. It's also not very intuitive to change the parameters to change the model behavior. Instead of a couple of simple inputs like tire stiffness and normal force the formula requires several parameters which are hard or even impossible to obtain. Needless to say, for a real time application in a vehicle there are better options.

The tire model created by Ola at BorgWarner AB that was used, was much simpler but still not as simple as the Dugoff or Brush models. A positive aspect of a simpler tire model is that it's easier to understand and experiment with. The five input parameters (slip ratio, normal force, tire/road friction coefficient, tire stiffness and curve inclination factor) are affiliated with the real world in much simpler way than the Magic Formula is. It was fairly easy to implement it together with the tire mode selector, hence it could be used to model both winter and summer tires without any severe modifications. Another advantage is that it does not include very advanced calculations, making it suitable for use in simple micro controllers. 

In the beginning of this work it was believed that the tire stiffness was a static parameter for each tire. After some research it was showed that the tire stiffness actually depends heavily on the tire/road friction coefficient. It was impossible make a tire model behave as a tire on both asphalt and ice with a static tire stiffness. If the tire stiffness was modeled as a simple linear function depending on the friction coefficient the model worked much better. This is partly in agreement with \cite{gustafsson1997} which was an article that was read really early but the idea was discarded because it didn't seem to fit the needs. The method in question is the slip-slope method. The idea is to estimate the tire/road friction coefficient by calculating the slope of the force per slip ratio curve while driving. Looking now at the linear functions for the tire stiffness developed in this thesis, it actually verifies Gustafsson's idea to some degree. The slip slope he describes is essentially the same thing as the linear functions for the tire stiffnesses used in this thesis to improve the tire model.


\subsection{Approximating the losses}
The formula for losses in the drive line where the gear ratio has an impact on the efficiency certainly is interesting. It was found on a private persons own web site. The person in question is named Steven Mason and has worked at the rotational machinery and controls laboratory at University of Virginia. Via e-mail contact it was learned that the formula came from lecture notes of T.C. Scott's course in Automotive Engineering and that he hadn't done any extensive tests of it. The formula works really well and since it did it was chosen to use even though the source isn't the best. Before the formula was found it was already shown that higher gear ratio appeared to lower the efficiency in the drive line which also strengthened the belief in the formula. 

\subsection{Slip ratio calculations}
The main problem regarding the slip ratio calculations is the approximation of the vehicles velocity. What's needed for a good slip ratio calculation is the wheels velocity relative the road in the exact same direction as the wheel in pointing. Thus, calculating the slip ratio based on the undriven wheel velocity only works good when driving in a straight line. Turning will make it much harder to calculate the true slip ratio value. Calculations of the velocity in the pointing direction is hard without for example an optical sensor that actually "reads" the road in real time. The biggest improvement would be to consider the lateral velocity of the vehicle as well. To estimate the lateral velocity was considered to be outside the scope of this work, but there already exist methods that could be used to approximate this. By combining longitudinal and lateral velocity, yaw rate and the wheel angle, the wheels actual heading velocity relative to the ground could be calculated, enabling a much better slip ratio estimation.

\subsection{Weight load transfer}
The weight transfer that actually affects the vehicle has a high impact on the used normal force for each tire, which has a high impact on the tire model force. The weight transfer function used in this work is rather simplified and a more correct way of calculating have unfortunately not been performed. A more accurate weight transfer model could make the tire force model more accurate.   

\section{Evaluating the results}
A further explanation of the results seen in Chapter \ref{chapter_five} will be presented in this section. The results are generally not revolutionizing with a quick and stable friction coefficient estimation, but rather show the results of real driving sequences. In some of the driving scenarios the friction coefficient is estimated fairly well, but in some cases the algorithm is shown to be insufficient. 

\subsection{Using winter tires}
The results that are presented when using the winter tires are overall better. Both the fast track run, the ice/snow driving sequence and the combined asphalt and ice/snow run show promising results when it comes to actually approximating the friction coefficient. The run done on the fast track with a lot of lateral acceleration (Figure \ref{force_mue_race}) shows that the lateral acceleration compensation works quite well.

The result that was seen in Figure \ref{force_mue_ice_normal} showed that the tire force varied with high frequency compared to the runs made on asphalt.The reason for this is the attribute of snow. The snow will make the road more bumpy making the wheel speeds, and therefore also the slip ratio, vary more. The snow is also pushed aside as the tires rotate, leading to further uneven signals. Even though these disturbances exist, the force from the two models match quite good, leading to a fairly stable friction estimation. 

During the combined sequence, it is clearly seen that two different friction coefficients between the tire and road is found. Do to the algorithms updating conditions, this takes a while longer at certain situations. In the zoomed in figure (Figure \ref{force_mue_comb2_zoom}), it can be seen that the friction estimation drops to $ \mu \approx 0.6 $ in under one second, which is two-thirds of the target friction at $ \mu = 0.4 $. The speed of the convergence is highly dependent on the $ \lambda $-value chosen for the RLS fitting method. With a choice of a smaller $ \lambda $, the change of $ \mu $ would be found faster, but to the price of a less stable approximation which would be more prone to consider errors. 

\subsection{Using summer tires}
The outcome from the driving sequence with summer tires on dry asphalt show some disapointing result. The sequence from a fast track lap is active almost a minute and the modeled forces are high numerous times. Despite this, the algorithm is barely active and the friction coefficient is only updated at a couple of short instances. The third line in Figure \ref{force_mue_race_bb}, \textit{tire model, all values}, is plotted to explain why the algorithm never gets the chance to update.

In the beginning of the run, time $ \leq 5 $ s, the tire model is shown to calculate a much higher force than the vehicle model. This is because a steering angle is present at a relatively low velocity, leading to a high slip ratio between the front and rear wheels. It is therefore correct to not update the friction coefficient at this time. 

There are three other occasions where the force from the vehicle is high and where the friction coefficient possibly could be estimated. These times are at around $ 17 $, $ 27 $, and $ 45 $ s. What happens at these moments is that the car has geared down, with a so called \textit{kickdown}, when the driver requests a higher acceleration. The result of a kickdown is that the expected force from the vehicle model is much greater, for a short period of time, than it actually is. This difference in force can be seen from the two curves \textit{vehicle model} and \textit{tire model, all values}, at these mentioned times. It is therefore correct to not let the algorithm update the friction coefficient at these times.

If the times mentioned above are excluded, the \textit{vehicle model} and \textit{tire model, all values} match quite well. At around $ 35 $ and $ 50 $ s, it is seen that the two models reflect each other closely. Unfortunately, the normalized forces are too far from the frictional limit, hence the friction estimation is said to be too inaccurate.

Another interesting result when using the summer tires on both dry and wet asphalt is that the amount of force generated per slip ratio, and therefore also the friction coefficient, seem to differ very little when comparing the two conditions. In Figure \ref{slip_kraft_blot_och_torr} it can be seen that the normalized force is larger for certain slip ratios when the driving was done on wet asphalt.
