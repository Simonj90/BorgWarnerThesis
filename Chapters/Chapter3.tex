\chapter{To estimate friction}

\section{What is friction? (baby don't Force me, don't Force me no more)}
Friction is the force that resists one element of material sliding against another. There are several types of friction, one of them is dry friction which resists relative lateral motion of two solid surfaces in contact. Hence dry friction is the force that one must overcome to pull a box along a floor. Dry friction is the friction that's important for this work. Further on, dry friction can be divided in two, static friction and kinetic friction. Coulomb friction is a model used to approximate dry friction. It's expressed as:

\begin{equation} \label{eq:friction}
F_{f}\leq\mu F_{n}
\end{equation}

where

\begin{itemize}
	\item $ F_{f} $ is the force of friction, it's parallel to the surface and has a direction opposed the applied net force.
	\item $ \mu $ is the coefficient of friction, different for different surfaces.
	\item $ F_{n} $ is the normal force exerted by each surface on the other.
\end{itemize}

This model provides a threshold for how much side force that can be applied before an object starts to move laterally. As long as the side force is less than or equal to the normal force multiplied by the coefficient of friction an equal amount of friction force will be generated in the opposite direction, thus preventing the object from moving. How much force that is needed to move an object along a surface is thus decided by two factors, the normal force acting on the object and the coefficient of friction between the two surfaces. When the applied side force gets larger than this threshold the object will start to move, hence leaving the static friction region and entering the kinetic friction region. The maximum side force that can be applied before an object starts moving is known as traction which is a common term when dealing with vehicles. It's simply how much longitudinal/lateral force a tire can handle before it loses the grip to the road and starts sliding.

The coefficient of friction for static friction is denoted as $ \mu_{s} $ and the one for kinetic friction as $ \mu_{k} $. Generally the kinetic coefficient of friction is lower than the static one. This means that the side force needed to make an object move is larger than the force needed to keep it sliding. ABS?!?!?! The friction coefficient between two materials needs to be determined empirically, it cannot be calculated. 

\section{Tire/road friction}
Tire/road friction is, as the name suggests, the friction between tire and road. Normally the tire road friction coefficient is within the range 0.1 - 1, 0.1 for bad tires on ice and 1 for good tires on dry asphalt. Rewriting equation \ref{eq:friction} gives:

\begin{equation} \label{eq:friction2}
\frac{F_{f}}{F_{n}} \leq\mu
\end{equation}

Having it on this form makes it easier to understand what a certain coefficient of friction really means for the vehicle. Having a coefficient of friction equal to 1 means that the force of friction can be as large as the normal force acting on the tire. This also mens that the force of friction for all tires can be as large as the normal force acting on the whole vehicle. Lets have an example. A car has a mass of 1 300 $ kg $. Lets assume that it's driving at a completely horizontal asphalt road with a coefficient of friction equal to 1. Since the road is horizontal the normal force acting on the vehicle can be expressed as:

\begin{equation} \label{eq:friction3}
F_{n}=mg \rightarrow F_{n} = 12766 N 
\end{equation}

Having a coefficient of friction equal to 1 means that the force friction can be equal to the normal force without the vehicle loosing grip. Thus, 12766 $ N $ of force can be used to accelerate the vehicle or 12766 $ N $ of force can be generated while cornering or braking without the vehicle loosing grip. Cornering and accelerating can be done at the same time, as long as the total amount of force the tires need to handle won't rise above 12766 $ N $.

The example above is extremely simplified, there are lots of other factors coming into play when a vehicle is accelerating of cornering but it still gives a good idea about the properties of tire/road friction. A coefficient of friction equal to 1 means that a force of friction equal to 100 $ \% $ of the normal force can be generate and a coefficient of friction equal to 0.1 means that a force of friction equal to 10 $ \% $ of the normal force can be generated.

The example also illustrates another important point. A vehicle can never accelerate faster or corner harder than 1 $ G $ (9.82 $ m/s^2 $). Unless some kind of downforce is generated. 

\section{Downforce}
Downforce is a downward force generated by the aerodynamics of a car. The idea is to increase the normal force acting on the car and by doing that more force of friction can be generated resulting in better grip. It's important to understand that the increased force of friction isn't due to a higher coefficient of friction, it's still the same. The increased grip comes purely from an increased normal force.

\section{Friction estimation approach}

The procedure on how the friction is to be estimated will be described later. This section is presented to get an understanding of the friction estimation approach that is used in this paper.

The first step includes calculating the forces acting on the tires by using a vehicle model. This is done by using parameters such as wheel speed, yaw rate and acceleration, and the fact that all forces acting on the car (neglecting wind drag) has to come from the ground through the tires. The second step is to calculate the force generated by the tire through a tire model. Such a model often depend on the tire stiffness, tire slips, normal force and the road friction coefficient. By changing the friction coefficient appropriately, the forces from the two separate models will be the same. This can for example be achieved by using some kind of least square fitting method. 

In a theoretical world, where a vehicle and tire model work perfect, the friction estimation becomes relatively easy and can be obtained with good certainty quite fast. Unfortunately there exists measurement and process noise in a real car and also an uncertainty from the models in some driving situations, which further complicate the work.

\section{Tire stiffness}

There are many parameters that need to be knows about the vehicle in order to estimate the friction well. One parameter that is not known (unless specified) is the stiffness of the tire. The force generated from the ground through the tires can, in the linear region, be described as a function of the tire stiffness and the slip. The lateral and longitudinal forces can be described respectively as
\begin{equation}
	F_{x} = C_{x}*\kappa
\end{equation}
\begin{equation}
	F_{y} = C_{\alpha}*\alpha
\end{equation}

The tire stiffness is therefore said to be the amount of force generated per slip, but only valid in the linear region. Thus the theoretical definition of the tire stiffness is the gradient of the force per slip around 0 slip, longitudinal tire stiffness can therefore be seen in FIGURE?!?!??!?. 

Different tires can have very different tire stiffness, which will have a large effect on the tire models. E.g. snow tires are much softer than summer tires and therefore lower stiffness. Generally, this also means that snow tires reach their maximum generated force at a larger slip then summer tires. The tire stiffness should not have to be set beforehand (meaning that the driver would have to specify if he/she changed tires) and therefore need to be estimated to accurate the friction estimation.
\section{Restrictions}

\begin{itemize}
	\item slip angle paverkar kraften i langsled
	\item Vy ar svart att fa fram
	\item langsaccelerometer finns inte alltid, berakna acc fran bakhjul brusigt
	\item vad hander nar hjulet spinner -> mycket slip, kraften okar ju inte
	\item kraften som kravs for acceleration paverkas av lutning av vag osv.
	\item 
\end{itemize}

\section{Restrictions and conditions, aoeh}

\subsection{Related work}

There have been lots of research and model proposals related to friction estimation during the last decades. The outcome of these papers usually show promising results, where the proposed solution works well during simulations and/or testing. The related work can provide a lot of information and help to this paper, especially to get the general understanding of the problem nd its difficulties. But due to the fact that most results are based on theoretical simulations and that this solution has to work in a real environment with actual sensor signals, a lot of the information provided through previous work within the field of study can be of little use or sometimes even misleading.

\subsection{Using an FXD}

The problem stated in this work is to estimate the tire/road friction for a car using an FXD, resulting in a number of conditions and restrictions that have to be thought of and applied throughout this work. First of all, cars with an FXD installed are solely front wheel driven, meaning that there are no positive longitudinal forces acting on the rear tires when accelerating. The velocity of the rear wheels can therefore in most cases be used as a good approximation for vehicles reference speed. Through the same reasoning, the longitudinal acceleration of the car can be derived from the derivative of the rear wheel velocities. Another aspect that has to be considered is that the FXD is an active limited slip differential, which means that the torque applied to the two driven shafts can be different in certain driving situations, unlike a car equipped with a standard open differential. 

\subsection{Theoretical vs. Practical :;.;:;pP;.,P,}

The true dynamics of a car, and especially a tire, is very complex and therefore difficult to describe accurately with a model. At the same time, a model has to be simple enough so that the calculations are possible on an engine control unit that has limited computational power. Even though many simplified models are shown to be accurate enough to reflect reality in most driving situations, there are times when a simplified model inaccurately describes the detailed dynamics of a vehicle or a tire. 

There are also numerous models that use different parameters that are hard to measure or approximate well in reality. Some of these parameters include the lateral velocity and slip angle. It is therefore desired to have a model that doesn't rely on these parameters. There are also car specific parameters that have impact on the models, some that can even change between driving sequences. A few of these parameters include the mass of the vehicle, wheel radius, wind drag coefficient, lengths from center of gravity to the two axis, and the center of gravity height. When using simulations, the exact value of these parameters can be known, but in a real environment they either have to be approximated or neglected in computations.

Together with the inaccurate measurements and process of signals mentioned earlier, it is a great challenge on the work of finding the estimated tire/road friction.  


The most important aspect that has to be considered is the fact that the friction estimation model has to work in a real car handled in actual driving situations. A major fact is that the sensor signals that are to be used  will come from the cars controller area network buss (CAN bus) and therefore include both measurement and process noise leading to inaccurate signals. 

\section{Friction models}

\begin{equation}
\mu(F_{z})=\mu_{nominal}*(\mu_{max} + (-k)\frac{F_{z} - F_{z_{0}}}{F_{z_{0}}})
\end{equation}

\subsection{Slip-slope friction model}

One friction model that is frequently used and referred to in research papers is the so called slip-slope friction model. The models general idea is that the maximum tire/road friction available can be decided due to its dependency on the slope from the slip-force curve in the linear region. This slip-force curve has the same characteristics as the slip-friction coefficient curve seen in Figure \ref{fric_slip}. 
\begin{equation}
	\dfrac{F_{x}}{F_{z}} = k*\kappa
\end{equation}
Where $ F_{x} $ and $ F_{z} $ is the estimated longitudinal and normal force acting on a tire depending on input values. The slip-slope can be estimated with for example recursive least square fitting.


\subsection{Kalman filter and recursive least squares}
This approach is done in two steps. First the forces on each wheel are estimated with a Kalman filter. Then the tire road friction coefficient is found by fitting a tire model to the estimated tire force.