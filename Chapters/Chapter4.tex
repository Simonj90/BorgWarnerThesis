\chapter{Friction estimation method}

This chapter will describe the chosen method that has been used to estimate the tire/road friction. Different approaches are weighted where a great deal of effort has been put on dealing with the fact that the method should work well in a practical manner, rather than during simulations.

\section{Approach}

The first step of the method include calculations of the forces acting on the vehicle by using a vehicle model. This is done by using measured and calculated parameters such as wheel speed, yaw rate and acceleration. The second step is to calculate the force generated by the tire through a tire model. Such a model often depend on the tire stiffness, tire slips, normal force and the road friction coefficient. The derived forces from the two separate models should be equal, which can be obtained by changing the friction coefficient appropriately. This can for example be achieved by using a least square fitting method. 

In a theoretical world, where a vehicle and tire model work perfect, the friction estimation becomes relatively easy and can be obtained with good certainty quite fast. Unfortunately there exists measurement and process noise in a real car and also a great uncertainty from the models in certain driving situations, which further complicate the work.

\subsection{Related work}

There have been quite extensive amount of research within this field of study and many different model proposals related to friction estimation during the last decades. The outcome of these researches usually show promising results, where the proposed solution works well during simulations and/or testing. Related work can provide a lot of information and help to the work done in this paper, especially when it comes to getting a general understanding of the problem and its difficulties. But due to the fact that many results are based on theoretical simulations, a lot of information can be of little use or in some cases even misleading.


\subsection{Conditions with an FXD}

The problem stated in this paper is to estimate the tire/road friction for a car using an FXD. This results in a number of conditions that have to be thought of and applied throughout the research. First of all, cars with an FXD installed are solely front wheel driven, meaning that there are no positive longitudinal forces acting on the rear tires. The velocity of the rear wheels can therefore in most cases be used as a good approximation as the vehicles reference speed. Through the same reasoning, the longitudinal acceleration of the car can be derived from the derivative of the rear wheel velocities. There is also no steering done by the rear wheels.

Another aspect that has to be considered is that the FXD is an active limited slip differential, which means that the torque applied to the two driving shafts can differ in certain situations, unlike a car equipped with a standard open differential.

\subsection{Practical restrictions}

The true dynamics of both a vehicle and a tire is very complex and therefore also difficult to describe accurately with a model. At the same time, a model that is to be used has to be simple enough so that calculations are possible on an engine control unit with limited computational power. Even though many simplified models are shown to be accurate enough to reflect reality in most driving situations, there are times when a simplified model inaccurately describes the detailed dynamics of a vehicle or a tire. 

There are also numerous models that use parameters which are hard to measure or approximate well in reality. Some of these parameters include the lateral velocity and slip angle. It is therefore desired to have a model that doesn't rely on these parameters. There are also car specific parameters, some which change between driving sequence, that can have large impact on the modeled results. A few of these parameters include the mass of the vehicle, wheel radius, wind drag coefficient, lengths from center of gravity to the two axis, and the center of gravity height. When using simulations, the exact value of these parameters can be known, but in a real environment they either have to be approximated or neglected in computations.

Together with the inaccurate measurements and process of signals mentioned earlier, it is a great challenge on the work of finding the estimated tire/road friction.  

The most important aspect that has to be considered is the fact that the friction estimation model has to work in a real car handled in actual driving situations. A major fact is that the sensor signals that are to be used  will come from the cars controller area network buss (CAN bus) and therefore include both measurement and process noise leading to inaccurate signals. 

\section{Slip-slope friction model (Stort parantes runt detta stycke, skall f√∂rmodligen bort eller flyttas)}

One friction model that is frequently used and referred to in research papers is the so called slip-slope friction model. The models general idea is that the maximum tire/road friction available can be decided due to its dependency on the slope from the slip-force curve in the linear region. This slip-force curve has the same characteristics as the slip-friction coefficient curve seen in Figure \ref{fric_slip}. 
\begin{equation}
\dfrac{F_{x}}{F_{z}} = k \cdot \kappa
\end{equation}
Where $ F_{x} $ and $ F_{z} $ is the estimated longitudinal and normal force acting on a tire depending on input values. The slip-slope can be estimated with for example recursive least square fitting.

\section{Vehicle forces}

A limitation set for this work is that the friction estimation is only possible when positive forces are acting on the vehicle. The slip ratios of the front wheels are made from calculations based on the velocities of the rear wheels. During braking, the rear wheels will also produce negative slip, and thus negative forces, which means that the slip ratios of the front wheels will be incorrect. 

The total amount of force acting on a car during an acceleration is primarily generated between the tires and the ground. While accelerating and braking longitudinal forces will arise and while cornering lateral forces will arise. Beside these force there are also forces such as wind drag and rolling resistance acting on the car. 

\subsection{Longitudinal force from vehicle acceleration}

The simplest way of representing the force acting on the vehicle while accelerating is to use the acceleration and the mass of the car and apply Newtons second law of motion:
\begin{equation}
	F = m \cdot a
\end{equation}
If a vehicle is not equipped with an longitudinal accelerometer, the acceleration of the vehicle can be derived by derivation of the undriven wheel velocity, i.e. the rear wheel velocities. Through the same reasoning as earlier, this last method will not produce correct results during braking, due to the negative slip on the rear wheels. 

This measured or derived acceleration is merely the resulting net force acting on the vehicle. The total amount of forces that is generated from the tires and up to the body have to include the losses that exist during acceleration. The resulting force that is generated therefore becomes: 
\begin{equation}
F_{tires} = m \cdot a + F_{steering loss} + F_{wind drag} + F_{rolling resistance}
\end{equation}
A problematic situation for this method occurs when the vehicle is accelerating on a gradient road. During an uphill acceleration, the actual forces acting on the car will be higher than the force calculated from the formula. When driving downhill, the force will be lower. 

\subsection{Longitudinal force from engine torque}

Another way of calculating the longitudinal force of a vehicle is to derive the actual torque that is applied to the shafts connected to the driving wheels. The advantage of using the engine torque, instead of the acceleration of the vehicle, is its independence of the roads gradient and losses such wind drag and steering losses. The torque that is applied to the shafts will be directly proportional to the actual force generated to the wheels, regardless of how the gravitational pull and other losses are acting. 

This method include some negative aspects that have to be thought of. It is unfortunately very uncommon for a commercially available vehicle today to have a torque sensor mounted, which means that the torque has to be obtained with other parameters. The torque applied to driving shaft is simply the torque generated from the engine multiplied by the current gear ratio. 
\begin{equation}
\label{eq:tshaft}
T_{shafts} = T_{engine}*Gear Ratio
\end{equation}
Where the gear ratio is the speed exchange from the engine shaft to the wheel shaft.
\begin{equation}
\label{eq:GR}
Gear Ratio = \frac{RPM_{engine}}{RPM_{drivenwheel}}
\end{equation}
The engine torque, engine speed and the wheel speeds are all parameters commonly found on the CAN bus of a newer car. Important to notice is that these calculations do not consider any losses from the engine out to the wheels.

The torque will be split evenly between the two shafts, assuming an open differential, i.e. when the FXD is inactive. By combining equations $ \ref{eq:GR} $ and $ \ref{eq:tshaft} $, it is also seen that the power generated by the engine and the power outputted to the shafts are equal.
\begin{equation}
	P = T_{shafts}*RPM_{wheel} = T_{engine}*RPM_{engine}
\end{equation}

\subsubsection{Transfer losses}
There are losses. We found Magic Formula 2.0.



There are several factors that affect how much of the engine torque that actually generates a driving force between the road and the tire. There are losses in form of friction within the driveline, and also rotating masses within the vehicle that have moment of inertias. 

The frictional losses are very dependant on the design of the engine, driveline, and transmisson. This means that the losses will differ between vehicle models and therefore there are no good model that can represent such losses accurately. It is however known that there are larger losses when the gear ratio transmission is larger. 

Each wheel connected to a driven shaft has its own moment of inertia which will be accelerated if enough torque is applied. The amount of torque needed to accelerate the wheel depends on its moment of inertia and the angular acceleration
\begin{equation}
	T = a \cdot I
\end{equation}
Where the moment of inertia is the sum of its integrated mass multiplied by its radii squared. 
\begin{equation}
	I = \int r^2 \cdot dm
\end{equation}
Assuming that a wheel has a shape of a solid cylinder with equal amount of density throughout, the moment of inertia for a wheel can be described as
\begin{equation}
	I = \dfrac{r^2 \cdot m}{2} 
\end{equation}
In the same manner, this applies for the actual shaft as well. 

By subtracting this torque from the shaft, the final torque which generates force between the tire and ground is obtained.
\begin{equation}
	T_{wheel} = T_{shaft} - T_{wheel acc}
\end{equation}
Thereafter the force, in $ N $, can be obtained by dividing the torque, in $ Nm $, by the radii of the wheel
\begin{equation}
	F_{tire} = \frac{T_{wheel}}{r_{wheel}}
\end{equation}
A restriction that has to be thought of is that the amount of force that can be generated between the tire and the road is limited by the tire/road friction and the normal, $ \mu \cdot F_{z} $. Any additional torque applied to the shaft will merely serve as unwanted acceleration of the wheel, i.e. spinning.


\section{Tire forces}

slip angle not known, limitation, only longitudinal

slip, mue, normal force!

The main dynamic parameters that affect the frictional force is the slip ratio, which comes from the difference in the wheels angular and  directional velocity, the normal force, which simply depends on the weight loaded on a tire, and also the tire/road friction coefficient, $ \mu $
\begin{equation}
	F_{tire} = f(\kappa, Fz, \mu)
\end{equation}
Where $ f $ is a function depending on these three parameters. The slip ratio and the normal force can be estimated by derivation of sensors signals. As mentioned earlier, the only way to generate a positive force to a vehicle is by generating a frictional force between the tire and the road. This means that the force derived from the vehicle model is equal to the forces from the two driving wheels tire model froce.
