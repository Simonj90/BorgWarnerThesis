\chapter{Friction estimation method}

This chapter will describes the method that has been chosen in order to achieve the best friction estimation result. Different approaches are weighted against each, where a great load has been put on how this application should work in a practical manner on a vehicle.

\section{Approach}

The procedure on how the friction is to be estimated will be described later. This section is presented to get an understanding of the friction estimation approach that is used in this paper.

The first step includes calculating the forces acting on the tires by using a vehicle model. This is done by using parameters such as wheel speed, yaw rate and acceleration, and the fact that all forces acting on the car (neglecting wind drag) has to come from the ground through the tires. The second step is to calculate the force generated by the tire through a tire model. Such a model often depend on the tire stiffness, tire slips, normal force and the road friction coefficient. By changing the friction coefficient appropriately, the forces from the two separate models will be the same. This can for example be achieved by using some kind of least square fitting method. 

In a theoretical world, where a vehicle and tire model work perfect, the friction estimation becomes relatively easy and can be obtained with good certainty quite fast. Unfortunately there exists measurement and process noise in a real car and also an uncertainty from the models in some driving situations, which further complicate the work.


\subsection{Related work}

There have been lots of research and model proposals related to friction estimation during the last decades. The outcome of these papers usually show promising results, where the proposed solution works well during simulations and/or testing. The related work can provide a lot of information and help to this paper, especially to get the general understanding of the problem nd its difficulties. But due to the fact that most results are based on theoretical simulations and that this solution has to work in a real environment with actual sensor signals, a lot of the information provided through previous work within the field of study can be of little use or sometimes even misleading.


\subsection{Conditions with an FXD}

The problem stated in this work is to estimate the tire/road friction for a car using an FXD, resulting in a number of conditions and restrictions that have to be thought of and applied throughout this work. First of all, cars with an FXD installed are solely front wheel driven, meaning that there are no positive longitudinal forces acting on the rear tires when accelerating. The velocity of the rear wheels can therefore in most cases be used as a good approximation for vehicles reference speed. Through the same reasoning, the longitudinal acceleration of the car can be derived from the derivative of the rear wheel velocities. Another aspect that has to be considered is that the FXD is an active limited slip differential, which means that the torque applied to the two driven shafts can be different in certain driving situations, unlike a car equipped with a standard open differential. 

\subsection{Practical restrictions}

The true dynamics of a car, and especially a tire, is very complex and therefore difficult to describe accurately with a model. At the same time, a model has to be simple enough so that the calculations are possible on an engine control unit that has limited computational power. Even though many simplified models are shown to be accurate enough to reflect reality in most driving situations, there are times when a simplified model inaccurately describes the detailed dynamics of a vehicle or a tire. 

There are also numerous models that use different parameters that are hard to measure or approximate well in reality. Some of these parameters include the lateral velocity and slip angle. It is therefore desired to have a model that doesn't rely on these parameters. There are also car specific parameters that have impact on the models, some that can even change between driving sequences. A few of these parameters include the mass of the vehicle, wheel radius, wind drag coefficient, lengths from center of gravity to the two axis, and the center of gravity height. When using simulations, the exact value of these parameters can be known, but in a real environment they either have to be approximated or neglected in computations.

Together with the inaccurate measurements and process of signals mentioned earlier, it is a great challenge on the work of finding the estimated tire/road friction.  


The most important aspect that has to be considered is the fact that the friction estimation model has to work in a real car handled in actual driving situations. A major fact is that the sensor signals that are to be used  will come from the cars controller area network buss (CAN bus) and therefore include both measurement and process noise leading to inaccurate signals. 


\section{Slip-slope friction model}

One friction model that is frequently used and referred to in research papers is the so called slip-slope friction model. The models general idea is that the maximum tire/road friction available can be decided due to its dependency on the slope from the slip-force curve in the linear region. This slip-force curve has the same characteristics as the slip-friction coefficient curve seen in Figure \ref{fric_slip}. 
\begin{equation}
\dfrac{F_{x}}{F_{z}} = k \cdot \kappa
\end{equation}
Where $ F_{x} $ and $ F_{z} $ is the estimated longitudinal and normal force acting on a tire depending on input values. The slip-slope can be estimated with for example recursive least square fitting.

\section{Vehicle forces}

A limitation set for this work is that the friction estimation is only possible when positive forces are acting on the vehicle. The slip ratios of the front wheels are made from calculations based on the velocities of the rear wheels. During braking, the rear wheels will also produce negative slip, and thus negative forces, which means that the slip ratios of the front wheels will be incorrect. 

The total amount of force acting on a car during an acceleration primarily comes from the driving forces generated from the ground up through the tires. Besides this, there are also negative forces acting on the car, such as wind drag, rolling resistance, losses in the driveline and due to steering. 

\subsection{Forces from vehicle acceleration}

The simplest way of representing the positive forces acting on the vehicle is to use the acceleration and mass and apply Newtons second law of motion
\begin{equation}
	F = m \cdot a
\end{equation}
If a vehicle is not equipped with an longitudinal accelerometer, the acceleration of the vehicle can be derived by derivation of an undriven, i.e. the rear wheel velocities. Through the same reasoning as earlier, this last method will not produce correct results during braking, due to the negative slip on the rear wheels. 

This measured or derived acceleration is merely the resulting net force acting on the vehicle. The total amount of forces that is generated from the tires and up to the body have to include the losses that exist during acceleration. The resulting force that is generated therefore becomes 
\begin{equation}
F_{tires} = a \cdot m + F_{steering loss} + F_{wind drag} + F_{rolling resistance}
\end{equation}
A problematic situation for this method occurs when the vehicle is accelerating on a gradient road. During an uphill acceleration, the actual forces acting on the car will be higher than the forces derived from the acceleration. When driving downhill, the acceleration will instead be  higher compared to true forces acting on the tires. 

\subsection{Forces from produced torque}

Another way of calculating the affecting forces of a vehicle is to derive the actual torque that is applied to the shafts connected to the driving wheels. The positive affect of using the produced torque, instead of the acceleration of the vehicle, is its independence of the roads gradient and losses such wind drag and steering losses. The torque that is applied to the shafts will always be equal to the torque out on the wheels, regardless of how the gravitational pull and other losses are acting. Each wheel connected to a driving shaft has its own moment of inertia which needs to be accelerated. The amount of torque needed to accelerate the wheel depends on its moment of inertia and the angular acceleration, where the moment of inertia is the sum of its mass multiplied by its radi squared
\begin{equation}
I = \sum m \cdot r^2
\end{equation}
\begin{equation}
	T = a \cdot I
\end{equation}
The resulting torque will generate a force between the tire and the ground.

In order to use this method for calculations of the vehicle forces, good knowledge of the momentary shaft torque is required. It is unfortunately very uncommon today for a commercially available vehicle to have such a sensor mounted, but the value can be derived from the engine torque and the current gear ratio. The gear ratio of the vehicle is the speed exchange between the engine and the wheels
\begin{equation}
	\label{eq:GR}
	Gear Ratio = \frac{RPM_{engine}}{RPM_{wheel}}
\end{equation}
The combined torque to the two driving shafts can thereafter be calculated by
\begin{equation}
	\label{eq:tshaft}
	T_{shafts} = T_{engine}*Gear Ratio
\end{equation}
This torque will be split evenly between the two shafts, assuming an open differential, e.i. the FXD is inactive. By combining equations $ \ref{eq:GR} $ and $ \ref{eq:tshaft} $, it is also seen that the power generated by the engine and the power outputted to the shafts are equal.
\begin{equation}
	P = T_{shafts}*RPM_{wheel} = T_{engine}*RPM_{engine}
\end{equation}
If calculated correctly, a torque, $ Nm $, can easily be converted into a force, $ N $, which is generated to the edge of the tires. This force is obtained by derivation by the radi of the wheel
\begin{equation}
	F_{tire} = \frac{T_{shaft}}{r_{wheel}}
\end{equation}
A restriction that has to be thought of is that the amount of force that can be generated between the tire and the road is limited by the tire/road friction, $ \mu $. Any additional torque applied to the shaft will merely serve as unwanted acceleration of the wheel, i.e. spinning.


\section{Tire forces}

slip angle not known, limitation, only longitudinal

slip, mue, normal force!

The main dynamic parameters that affect the frictional force is the slip ratio, which comes from the difference in the wheels angular and  directional velocity, the normal force, which simply depends on the weight loaded on a tire, and also the tire/road friction coefficient, $ \mu $
\begin{equation}
	F_{tire} = f(\kappa, Fz, \mu)
\end{equation}
Where $ f $ is a function depending on these three parameters. The slip ratio and the normal force can be estimated by derivation of sensors signals. As mentioned earlier, the only way to generate a positive force to a vehicle is by generating a frictional force between the tire and the road. This means that the force derived from the vehicle model is equal to the forces from the two driving wheels tire model froce.
